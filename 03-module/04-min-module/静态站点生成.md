@[TOC](静态站点生成)

# 静态网站生成器

**什么是静态网站生成器**

* 静态网站生成器是一系列配置、模板以及数据，生成静态 HTML 文件及相关资源的工具
* 这个功能也叫 **预渲染**
* 生成的网站不需要类似 **PHP** 这样的服务器
* 只需要放到支持静态资源的 **Web Server** 或 **CDN** 上即可运行

**静态网站的好处**

* 省钱
  * 不需要专业的服务器，只要能托管静态文件的空间即可
* 快速
  * 不经过后端服务器的处理，只传输内容
* 安全
  * 没有后端程序的运行，自然会更安全

**常见的静态网站生成器** 

* Jekyll（Ruby）
* Hexo（Node）
* Hugo（Golang）
* Gatsby（Node/React）
* Gridsome（Node/Vue）
* 另外，Next.js，Nuxt.js 也能生成静态网站，但是它们更多被认为是 SSR（服务端渲染）框架。

**JAMStack**

 **JAMStack**(静态网站生成器) 使您可以通过预渲染文件并直接从CDN直接提供文件来构建快速安全的站点和应用程序，而无需管理或运行Web服务器。

* 学习网站：[Learn more about the Jamstack](https://gridsome.org/docs/jamstack).
* JAMStack 的 JAM 是 JavaScript、API 和 Markup 的首字母组合
* 本质上是一种胖前端，通过调用各种 API 来实现更多的功能
* 其实也是一种前后端的模式，只不过离得比较开，甚至前后端来自多个不同的厂商

**静态应用的使用场景**

* 不适合有大量路由页面的应用
  * 如果您的站点有成百上千条路由页面，则预渲染将非常缓慢。当然，你每次更新只需要做一次，但是可能要花一些时间。大多数人不会最终获得数千条静态路由页面，而只是以防万一。
* 不适合有大量动态内容的应用
  * 如果渲染路线中包含特定于用户查看其内容或其动态源的内容，则应确保您具有可以显示的占位符组件，直到动态内容加载到客户端为止。否则可能有点怪异。

# Gridsome 

![image-20210120153314312](F:\LaGou\03-module\04-min-module\assets\image-20210120153314312.png)

## 基本介绍

### Gridsome 是什么

- 一个免费、开源、基于 Vue.js 技术栈的静态网站生成器。
- 官方网站：[https://gridsome.org/](https://gridsome.org/)
- GitHub 仓库：[https://github.com/gridsome/gridsome](https://github.com/gridsome/gridsome)
- Gridsome 是由Vue.js驱动的Jamstack框架，用于构建默认情况下快速生成的静态生成的网站和应用。
- Gridsome是Vue提供支持的静态站点生成器，用于为任何无头CMS，本地文件或API构建可用于CDN的网站
- 使用Vue.js，webpack和Node.js等现代工具构建网站。通过npm进行热重载并访问任何软件包，并使用自动前缀在您喜欢的预处理器（如Sass或Less）中编写CSS。
- 基于 Vue.js 的 Jamstack 框架
- Gridsome 使开发人员可以轻松构建默认情况下快速生成的静态生成的网站和应用程序
- Gridsome允许在内容里面引用任何CMS或数据源。
  从WordPress，Contentful或任何其他无头CMS或API中提取数据，并在组件和页面中使用GraphQL访问它。

### 为什么选择 Gridsome

- **Vue.js for frontend** - The simplest & most approachable frontend framework.
- **Data sourcing** - Use any Headless CMSs, APIs or Markdown-files for data.
- **Local development with hot-reloading** - See code changes in real-time.
- **File-based page routing** - Any `Name.vue` file in `src/pages` is a static route.
- **Dynamic routing** - Any `[param].vue` file in `src/pages` is a dynamic route.
- **Static file generation** - Deploy securely to any CDN or static web host.
- **GraphQL data layer** - Simpler data management with a centralized data layer.
- **Automatic Code Splitting** - Builds ultra performance into every page.
- **Plugin ecosystem** - Find a plugin for any job.

### 它是如何工作的

Gridsome生成静态HTML，一旦加载到浏览器中，该HTML就会渗入Vue SPA。这意味着您可以使用Gridsome构建静态网站和动态应用程序。

Gridsome为每个页面构建一个.html文件和一个.json文件。加载第一页后，它仅使用.json文件来预取和加载下一页的数据。它还为需要它的每个页面构建一个.js包（代码拆分）。

它使用vue-router进行SPA路由，并使用vue-meta来管理<head>。

Gridsome默认添加最小57kB的gzip JS捆绑包大小（vue.js，vue-router，vue-meta和一些用于图像延迟加载的文件）。

[详细了解其工作原理](https://gridsome.org/docs/how-it-works)

## 学习条件

您应该具有有关HTML，CSS，Vue.js以及如何使用终端的基本知识。了解GraphQL的工作原理是有好处的，但不是必需的。 Gridsome是学习它的好方法。

Gridsome 需要Node.js（v8.3 +），并建议使用 Yarn。

## 备选方案

- [VuePress](https://vuepress.vuejs.org/)
- [Nuxt](https://nuxtjs.org/)
- [Gatsby.js](https://www.gatsbyjs.org/)

## 使用场景

- 不适合管理系统
- 简单页面展示
- 想要有更好的 SEO
- 想要有更好的渲染性能

## 基本使用

> 目标：快速了解 Gridsome 项目

* 1，安装 Gridsome CLI

  ```powershell
  # 使用 yarn
  yarn global add @gridsome/cli
  
  # 使用 npm
  npm install --global @gridsome/cli
  
  # 查看是否安装成功
  gridsome --version
  ```

* 2，创建 Gridsome 项目

  ```sh
  # 创建项目
  gridsome create my-gridsome-site
  
  # 进入项目中
  cd my-gridsome-site
  
  # 启动开发模式，或 npm run develop
  gridsome develop
  ```

> <font color="#f00">**gridsome 项目安装依赖注意事项：**</font>
>
> - 配置 node-gyp 编译环境
>   - [https://github.com/nodejs/node-gyp](https://github.com/nodejs/node-gyp)
>
> - 配置环境变量：`npm_config_sharp_libvips_binary_host` 为 `https://npm.taobao.org/mirrors/sharp-libvips/`
>   - https://github.com/lovell/sharp-libvips
>   - https://developer.aliyun.com/mirror/NPM
>   - https://npm.taobao.org/mirrors
>   - https://sharp.pixelplumbing.com/install
>     - `npm config set sharp_binary_host "https://npm.taobao.org/mirrors/sharp"`
>     - `npm config set sharp_libvips_binary_host "https://npm.taobao.org/mirrors/sharp-libvips"`
> - 配置 hosts：`199.232.68.133  raw.githubusercontent.com`
>   - https://www.ipaddress.com/

3、目录结构

```bash
.
├── src
│   ├── components # 公共组件
│   ├── layouts # 布局组件
│   ├── pages # 页面路由组件
│   ├── templates # 模板文件
│   ├── favicon.png # 网站图标
│   └── main.js # 应用入口
├── static # 静态资源存储目录，该目录中的资源不做构建处理
├── README.md
├── gridsome.config.js # 应用配置文件
├── gridsome.server.js # 针对服务端的配置文件
├── package-lock.json
└── package.json
```



4、自己试一试

- 在 `src/pages` 目录中创建一个 `.vue` 组件

5、构建

```bash
gridsome build
```

构建结果默认输出到 `dist` 目录中。

Gridsome 会把每个路由文件构建为独立的 HTML 页面。

6、部署

可以把构建结果 `dist` 放到任何 Web 服务器中进行部署。

例如我们这里使用 Node.js 命令行工具 [serve](https://github.com/vercel/serve) 来测试构建结果。

```bash
npm install -g serve

serve dist
```

或者可以部署到其它第三方托管平台：https://gridsome.org/docs/deployment/。

或是自己的服务器，都可以！

## 核心概念

> 目标：学习 Gridsome 的核心概念

### Pages

通过在 src/pages 文件夹中添加Vue组件来创建页面。他们使用基于文件的路由系统。例如，src / pages / About.vue将是 mywebsite.com/about/。页面用于简单页面和列出集合的页面（例如/ blog /）。

了解有关页面的更多信息：https://gridsome.org/docs/pages/。

### Collections

如果您要在网站上放置博客文章，标签，产品等，则收藏很有用。可以使用 [Source插件](https://gridsome.org/plugins)或 [Data Store API](https://gridsome.org/docs/data-store-api/) 从任何Headless CMS，内容API或Markdown文件中获取集合。

![](F:/LaGou/03-module/resources/03-04-study-materials/handouts/3-4-2/assets/node-pages.0eae6d2.8581c59dbb258143a7ffcebb617ec5dc.png)

集合存储在临时的本地GraphQL数据层中，可以在任何地方查询，过滤，分页或有关系。

### Templates

模板负责显示集合的节点（单个页面）。模板通常位于src / templates中。如果未在模板配置中指定组件，则Gridsome尝试查找与集合名称相同的文件。

这是一个例子：

```html
<!-- src/templates/Post.vue -->
<template>
  <Layout>
    <h1 v-html="$page.post.title" />
  </Layout>
</template>

<page-query>
query ($id: ID!) {
  post(id: $id) {
    title
  }
}
</page-query>
```

更多关于 Templates 的内容：https://gridsome.org/docs/templates/。

### Layouts

布局是在页面和模板内部用于包装内容的Vue组件。布局通常包含页眉和页脚。

页面中通常按以下方式使用布局：

```html
<template>
  <Layout>
    <h1>About us</h1>
  </Layout>
</template>

<script>
import Layout from '~/layouts/Default.vue'

export default {
  components: {
    Layout
  }
}
</script>
```

> 也可以在全球范围内使用布局，因此您无需每页导入它们。
>
> 请注意，Gridsome CLI创建的默认模板将使用全局布局组件。

更多关于 Layouts 的内容：https://gridsome.org/docs/layouts/。

### Images

Gridsome具有内置的 `<g-image>` 组件，可输出优化的逐行图像。如果更改宽度和高度，则在开发时还可以实时调整大小和裁剪。 `<g-images>` 创建一个超小型模糊的嵌入式base64图像，然后在视图中使用IntersectionObserver延迟加载图像。

更多关于 Images 的内容：https://gridsome.org/docs/images/。

### Linking

Gridsome具有内置的 `<g-link>` 组件，该组件在查看链接时使用 IntersectionObserver 来预取链接的页面。这使得在 Gridsome 站点中浏览非常快，因为单击的页面已经下载。

更多关于 `<g-link>` 的内容：https://gridsome.org/docs/linking/。



## 部署

> https://gridsome.org/docs/deployment/



